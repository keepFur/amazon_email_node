"use strict";layui.use(["element"],function(){var n=echarts.init(document.getElementById("taskCount")),o=echarts.init(document.getElementById("taskType")),i=echarts.init(document.getElementById("addScore")),d={title:{text:"创建任务量走势图"},tooltip:{},legend:{right:10,top:0,data:["任务量"]},xAxis:{data:[]},yAxis:{},series:[{name:"任务量",type:"line",data:[]}]},c={title:{text:"创建任务类型分布图"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:0,bottom:20,data:["APP搜索"]},series:[{name:"任务类型",type:"pie",radius:"55%",center:["40%","50%"],data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},s={title:{text:"积分充值柱状图"},tooltip:{},legend:{right:10,top:0,data:["积分充值"]},xAxis:{data:[]},yAxis:{},series:[{name:"积分充值",type:"bar",data:[]}]};function r(t){var a=y(t=t||7),e=a[0],r=a[t-1];d.xAxis.data=a,$.get("/api/readTaskCountOfInTime",{createdDateStart:e,createdDateEnd:r},function(t){var e=t.data.rows;a.forEach(function(t){f(t,e)||e.push({createdDate:$.formatDate("yyyy/mm/dd",t),count:0})}),(e=e.map(function(t,e){return{createdDate:$.formatDate("yyyy/mm/dd",t.createdDate),count:t.count}})).sort(function(t,e){return new Date(t.createdDate).getTime()-new Date(e.createdDate).getTime()}),d.series[0].data=e.map(function(t,e){return t.count}),n.setOption(d)})}function u(t){var e=y(t=t||7),a=e[0],r=e[t-1];$.get("/api/readTaskTypeOfInTime",{createdDateStart:a,createdDateEnd:r},function(t){var e=t.data.rows;c.series[0].data=e.map(function(t){return{name:core.getTypeCodeByValue(t.taskChildType).name,value:t.count}}),o.setOption(c)})}function m(t){var a=y(t=t||7),e=a[0],r=a[t-1];s.xAxis.data=a,$.get("/api/readAddMoneyOfInTime",{createdDateStart:e,createdDateEnd:r},function(t){var e=t.data.rows;a.forEach(function(t){f(t,e)||e.push({createdDate:$.formatDate("yyyy/mm/dd",t),count:0})}),(e=e.map(function(t,e){return{createdDate:$.formatDate("yyyy/mm/dd",t.createdDate),count:t.count}})).sort(function(t,e){return new Date(t.createdDate).getTime()-new Date(e.createdDate).getTime()}),s.series[0].data=e.map(function(t,e){return t.count}),i.setOption(s)})}function y(t){if(t=t||7,isNaN(t))return console.log(t),[];for(var e=(new Date).getTime()-24*t*60*60*1e3,a=[],r=0;r<t;r++)a[r]=$.formatDate("yyyy/mm/dd",new Date(e+864e5*(r+1)));return a}function f(e,t){var a=!1;return e&&t&&Array.isArray(t)&&t.forEach(function(t){if($.formatDate("yyyy/mm/dd",t.createdDate)===e)return!(a=!0)},this),a}r(),u(),m(),core.getUserInfoById($("#userName").data("user-id"),function(t){$(".js-user-score").text(t.data.rows[0].money)}),$(".js-home-toggle-date").on("click","a",function(t){var e=$(this).data("type"),a=$(this).data("day");switch($(this).parents(".js-home-toggle-date").find("a").removeClass("layui-text-pink"),$(this).addClass("layui-text-pink"),e){case"count":r(a);break;case"type":u(a);break;case"addmoney":m(a);break;default:r(a)}return!1})});