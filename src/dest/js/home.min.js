"use strict";layui.use(["element","layer"],function(){var a=layui.element,t=layui.layer,r=echarts.init(document.getElementById("taskCount")),i=echarts.init(document.getElementById("taskType")),o=echarts.init(document.getElementById("addScore")),d=($("#userName").data("user-id"),{title:{text:"创建任务量走势图"},tooltip:{},legend:{right:10,top:0,data:["任务量"]},xAxis:{data:[]},yAxis:{},series:[{name:"任务量",type:"line",data:[]}]}),c={title:{text:"创建任务类型分布图"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:0,bottom:20,data:["APP搜索"]},series:[{name:"任务类型",type:"pie",radius:"55%",center:["40%","50%"],data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},s={title:{text:"余额充值柱状图"},tooltip:{},legend:{right:10,top:0,data:["余额充值"]},xAxis:{data:[]},yAxis:{},series:[{name:"余额充值",type:"bar",data:[]}]};function n(e){var a=m(e=e||7),t=a[0],n=a[e-1];d.xAxis.data=a,$.get("/api/readTaskCountOfInTime",{createdDateStart:t,createdDateEnd:n},function(e){var t=e.data.rows;a.forEach(function(e){l(e,t)||t.push({createdDate:$.formatDate("yyyy/mm/dd",e),count:0})}),(t=t.map(function(e,t){return{createdDate:$.formatDate("yyyy/mm/dd",e.createdDate),count:e.count}})).sort(function(e,t){return new Date(e.createdDate).getTime()-new Date(t.createdDate).getTime()}),d.series[0].data=t.map(function(e,t){return e.count}),r.setOption(d)})}function u(e){var t=m(e=e||7),a=t[0],n=t[e-1];$.get("/api/readTaskTypeOfInTime",{createdDateStart:a,createdDateEnd:n},function(e){var t=e.data.rows;c.series[0].data=t.map(function(e){return{name:core.getTypeCodeByValue(e.taskChildType).name,value:e.count}}),i.setOption(c)})}function y(e){var a=m(e=e||7),t=a[0],n=a[e-1];s.xAxis.data=a,$.get("/api/readAddMoneyOfInTime",{createdDateStart:t,createdDateEnd:n},function(e){var t=e.data.rows;a.forEach(function(e){l(e,t)||t.push({createdDate:$.formatDate("yyyy/mm/dd",e),count:0})}),(t=t.map(function(e,t){return{createdDate:$.formatDate("yyyy/mm/dd",e.createdDate),count:e.count}})).sort(function(e,t){return new Date(e.createdDate).getTime()-new Date(t.createdDate).getTime()}),s.series[0].data=t.map(function(e,t){return e.count}),o.setOption(s)})}function m(e){if(e=e||7,isNaN(e))return console.log(e),[];for(var t=(new Date).getTime()-24*e*60*60*1e3,a=[],n=0;n<e;n++)a[n]=$.formatDate("yyyy/mm/dd",new Date(t+864e5*(n+1)));return a}function l(t,e){var a=!1;return t&&e&&Array.isArray(e)&&e.forEach(function(e){if($.formatDate("yyyy/mm/dd",e.createdDate)===t)return!(a=!0)},this),a}n(),u(),y(),core.getUserInfoById($("#userName").data("user-id"),function(e){$(".js-user-score").text(e.data.rows[0].money)}),$(".js-home-toggle-date").on("click","a",function(e){var t=$(this).data("type"),a=$(this).data("day");switch($(this).parents(".js-home-toggle-date").find("a").removeClass("layui-text-pink"),$(this).addClass("layui-text-pink"),t){case"count":n(a);break;case"type":u(a);break;case"addmoney":y(a);break;default:n(a)}return!1}),$("#viewMoreNotice").click(function(e){return t.open({content:'<div  id="noticeContainer" style="min-height:500px;overflow-y:auto;"></div>',area:["450px"],title:"公告列表",btn:"关闭",scrollbar:!1,shadeClose:!0,success:function(e,t){$.ajax({url:"/api/readNoticePage",data:{limit:5,offset:1},dataType:"json",success:function(e){var t;t=e.data.rows,$.each(t,function(e,t){var a;$("#noticeContainer").append('<div class="layui-card">\n                        <div class="layui-card-header">标题：'+(a=t).noticeTitle+'</div>\n                        <div class="layui-card-body">内容：'+a.noticeContent+"</div>\n                    </div>")}),a.render("collapse")}})}}),!1})});