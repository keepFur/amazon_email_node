"use strict";layui.use(["element","layer"],function(){var a=layui.element,e=layui.layer,r=echarts.init(document.getElementById("taskCount")),i=echarts.init(document.getElementById("kbCount")),o=echarts.init(document.getElementById("taskType")),d=echarts.init(document.getElementById("kbType")),c=echarts.init(document.getElementById("addScore")),s={title:{text:"流量购买量走势图"},tooltip:{},legend:{right:10,top:0,data:["流量购买量"]},xAxis:{data:[]},yAxis:{},series:[{name:"来了购买量",type:"line",data:[]}]},u={title:{text:"空包购买量走势图"},tooltip:{},legend:{right:10,top:0,data:["空包购买量"]},xAxis:{data:[]},yAxis:{},series:[{name:"空包购买量",type:"line",data:[]}]},m={title:{text:"流量购买类型分布图"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"流量类型",type:"pie",radius:"55%",center:["40%","50%"],data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},y={title:{text:"空包购买类型分布图",x:"right"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"空包类型",type:"pie",radius:"55%",center:["40%","50%"],data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},l={title:{text:"余额充值柱状图"},tooltip:{},legend:{right:10,top:0,data:["余额充值"]},xAxis:{data:[]},yAxis:{},series:[{name:"余额充值",type:"bar",data:[]}]};function n(t){var a=h(t=t||7),e=a[0],n=a[t-1];s.xAxis.data=a,$.get("/api/readTaskCountOfInTime",{createdDateStart:e,createdDateEnd:n},function(t){var e=t.data.rows;a.forEach(function(t){v(t,e)||e.push({createdDate:$.formatDate("yyyy/mm/dd",t),count:0})}),(e=e.map(function(t,e){return{createdDate:$.formatDate("yyyy/mm/dd",t.createdDate),count:t.count}})).sort(function(t,e){return new Date(t.createdDate).getTime()-new Date(e.createdDate).getTime()}),s.series[0].data=e.map(function(t,e){return t.count}),r.setOption(s)})}function f(t){var a=h(t=t||7),e=a[0],n=a[t-1];u.xAxis.data=a,$.get("/api/readKbCountOfInTime",{createdDateStart:e,createdDateEnd:n},function(t){var e=t.data.rows;a.forEach(function(t){v(t,e)||e.push({createdDate:$.formatDate("yyyy/mm/dd",t),count:0})}),(e=e.map(function(t,e){return{createdDate:$.formatDate("yyyy/mm/dd",t.createdDate),count:t.count}})).sort(function(t,e){return new Date(t.createdDate).getTime()-new Date(e.createdDate).getTime()}),u.series[0].data=e.map(function(t,e){return t.count}),i.setOption(u)})}function p(t){var e=h(t=t||7),a=e[0],n=e[t-1];$.get("/api/readTaskTypeOfInTime",{createdDateStart:a,createdDateEnd:n},function(t){var e=t.data.rows;m.series[0].data=e.map(function(t){return{name:t.taskTypeName,value:t.count}}),o.setOption(m)})}function D(t){var e=h(t=t||7),a=e[0],n=e[t-1];$.get("/api/readKbTypeOfInTime",{createdDateStart:a,createdDateEnd:n},function(t){var e=t.data.rows;y.series[0].data=e.map(function(t){return{name:core.getPlantByCode(t.plant)+"("+t.kbCompany+")",value:t.count}}),d.setOption(y)})}function g(t){var a=h(t=t||7),e=a[0],n=a[t-1];l.xAxis.data=a,$.get("/api/readAddMoneyOfInTime",{createdDateStart:e,createdDateEnd:n},function(t){var e=t.data.rows;a.forEach(function(t){v(t,e)||e.push({createdDate:$.formatDate("yyyy/mm/dd",t),count:0})}),(e=e.map(function(t,e){return{createdDate:$.formatDate("yyyy/mm/dd",t.createdDate),count:t.count}})).sort(function(t,e){return new Date(t.createdDate).getTime()-new Date(e.createdDate).getTime()}),l.series[0].data=e.map(function(t,e){return core.fenToYuan(t.count)}),c.setOption(l)})}function h(t){if(t=t||7,isNaN(t))return console.log(t),[];for(var e=(new Date).getTime()-24*t*60*60*1e3,a=[],n=0;n<t;n++)a[n]=$.formatDate("yyyy/mm/dd",new Date(e+864e5*(n+1)));return a}function v(e,t){var a=!1;return e&&t&&Array.isArray(t)&&t.forEach(function(t){if($.formatDate("yyyy/mm/dd",t.createdDate)===e)return!(a=!0)},this),a}n(),f(),p(),D(),g(),core.getUserInfoById(function(t){$(".js-user-score").text(core.fenToYuan(t.data.rows[0].money))}),$(".js-home-toggle-date").on("click","a",function(t){var e=$(this).data("type"),a=$(this).data("day");switch($(this).parents(".js-home-toggle-date").find("a").removeClass("layui-btn-normal").addClass("layui-btn-primary"),$(this).addClass("layui-btn-normal").removeClass("layui-btn-primary"),e){case"count":n(a);break;case"kbCount":f(a);break;case"type":p(a),D(a);break;case"addmoney":g(a);break;default:n(a)}return!1}),$("#viewMoreNotice").click(function(t){return e.open({content:'<div  id="noticeContainer" style="min-height:500px;overflow-y:auto;"></div>',area:["450px"],title:"公告列表",btn:"关闭",scrollbar:!1,shadeClose:!0,success:function(t,e){$.ajax({url:"/api/readNoticePage",data:{limit:5,offset:1},dataType:"json",success:function(t){var e;e=t.data.rows,$.each(e,function(t,e){var a;$("#noticeContainer").append('<div class="layui-card">\n                        <div class="layui-card-header">标题：'+(a=e).noticeTitle+'</div>\n                        <div class="layui-card-body">内容：'+a.noticeContent+"</div>\n                    </div>")}),a.render("collapse")}})}}),!1})});