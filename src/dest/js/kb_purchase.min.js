"use strict";layui.use(["form","element","table","layer","util"],function(){var r=layui.form,o=layui.table,u=layui.layer,a=layui.util,d={netErrMsg:"系统已退出登录，请登录系统重试",operatorErrMsg:{single:"请选择一条数据操作",batch:"请至少选择一条数据操作"}};function e(e){var a,s=core.getFormValues($("form[name=kbOrderForm]")),t=(a=s)?a.kbCompany?a.addressFrom?a.addressTo?{isPass:!0,msg:""}:{isPass:!1,msg:"请输入收货地址"}:{isPass:!1,msg:"请选择发货地址"}:{isPass:!1,msg:"请选择快递类型"}:{isPass:!1,msg:"参数错误"};return t.isPass?(s.total=1e3,s.number=APIUtil.generateOrderNumer(),s.addressTo=s.addressTo.split(/\n/g).filter(function(e){return!!e}),$.ajax({url:"/api/createKbOrder",type:"POST",data:s,success:function(e,a,s){u.msg(e.success?"操作成功":"操作失败"),e.success&&core.setWindowHash("manage_kb_order")},error:function(e,a,s){u.msg(d.errorMsg)}})):u.msg(t.msg),!1}function s(e){return u.open({content:'<form class="layui-form layui-form-pane" name="kbAddressCreateForm">\n                            <div class="layui-form-item">\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">寄件人</label>\n                                    <div class="layui-input-block">\n                                        <input class="layui-input"  name="contact"/>\n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">手机号</label>\n                                    <div class="layui-input-block">\n                                        <input class="layui-input"  name="phone"/> \n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">邮编</label>\n                                    <div class="layui-input-block">\n                                        <input class="layui-input"  name="email"/> \n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">地址</label>\n                                    <div class="layui-input-block">\n                                        <textarea class="layui-textarea"  name="detail"></textarea>\n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">备注</label>\n                                    <div class="layui-input-block">\n                                        <input type="text" name="remark"  class="layui-input">\n                                    </div>\n                                </div>\n                            </div>\n                        </form>',title:"创建收货地址",btn:["创建","取消"],area:["450px"],yes:function(t){var e=core.getFormValues($("form[name=kbAddressCreateForm]")),a=m(e);a.isPass?$.ajax({url:"/api/createKbAddress",type:"POST",data:e,success:function(e,a,s){u.msg(e.success?"操作成功":"操作失败"),u.close(t),c(),p()},error:function(e,a,s){u.msg(d.errorMsg)}}):u.msg(a.msg)}}),!1}function t(e){var s=o.checkStatus("kbAddressTable").data;if(1===s.length){var a=s[0].contact,t=s[0].phone,l=s[0].detail,n=s[0].remark,i=s[0].email;u.open({content:'<form class="layui-form layui-form-pane" name="kbAddressUpdateForm" lay-filter="kbAddressUpdateForm">\n                            <div class="layui-form-item">\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">寄件人</label>\n                                    <div class="layui-input-block">\n                                        <input class="layui-input" value="'+a+'" name="contact" />\n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">手机号</label>\n                                    <div class="layui-input-block">\n                                        <input class="layui-input" value="'+t+'" name="phone"/>\n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">邮编</label>\n                                    <div class="layui-input-block">\n                                        <input class="layui-input" value="'+i+'" name="email"/>\n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">地址</label>\n                                    <div class="layui-input-block">\n                                        <textarea class="layui-textarea"  name="detail"></textarea>\n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">备注</label>\n                                    <div class="layui-input-block">\n                                        <input type="text" name="remark" value="'+n+'" class="layui-input">\n                                    </div>\n                                </div>\n                            </div>\n                        </form>',title:"收货地址信息修改",btn:["确定","取消"],area:["450px"],yes:function(t){var e=core.getFormValues($("form[name=kbAddressUpdateForm]")),a=m(e);e.id=s[0].id,a.isPass?$.ajax({url:"/api/updateKbAddress",type:"POST",data:e,success:function(e,a,s){u.msg(e.success?"操作成功":"操作失败"+e.message),u.close(t),c(),p()},error:function(e,a,s){u.msg(d.errorMsg)}}):u.msg(a.msg)},success:function(){r.val("kbAddressUpdateForm",{detail:l})}})}else u.msg(d.operatorErrMsg.single);return!1}function l(e){var a=o.checkStatus("kbAddressTable").data,s=e.data.type,t=0===s?"确定禁用吗？":"确定启用吗？";return 1===a.length?u.confirm(t,{btn:["确定","取消"],title:"询问框"},function(){$.ajax({url:"/api/toggleKbAddress",type:"POST",data:{id:a[0].id,status:s},success:function(e,a,s){u.msg(e.success?"操作成功":"操作失败"+e.message),c()},error:function(e,a,s){u.msg(d.netErrMsg)}})}):u.msg(d.operatorErrMsg.single),!1}function c(e){o.reload("kbAddressTable",e)}function m(e){return e?e.detail?e.contact?e.phone?e.email?{isPass:!0,msg:""}:{isPass:!1,msg:"邮编不能为空"}:{isPass:!1,msg:"手机号不能为空"}:{isPass:!1,msg:"联系人不能为空"}:{isPass:!1,msg:"详细地址不能为空"}:{isPass:!1,msg:"参数错误"}}function n(e){$.get("/api/readKbType?status=1&plant="+e,function(e){var a,s;a=e.data.rows,(s=$("select[name=kbCompany]")).empty(),s.append('<option value="">请选择快递类型</option>'),$.each(a,function(e,a){s.append('<option value="'+a.code+'">'+a.name+"</option>")}),r.render("select")},"json")}function p(){$.get("/api/readKbAddress?status=1",function(e){var a,s;a=e.data.rows,(s=$("select[name=addressFrom]")).empty(),s.append(' <option value="">请选择发货地址</option>'),$.each(a,function(e,a){s.append('<option value="'+a.detail+'">'+a.detail+" "+a.contact+" "+a.phone+" "+a.email+"</option>")}),r.render("select")},"json")}r.render("select"),r.render("radio"),n("TB"),p(),o.render({elem:"#kbAddressTable",url:"/api/readKbAddress",cols:[[{checkbox:!0},{title:"寄件人",field:"contact"},{title:"手机",field:"phone"},{title:"地址",field:"detail"},{title:"邮编",field:"email"},{title:"备注",field:"remark"},{title:"创建时间",field:"createdDate",templet:function(e){return a.toDateString(e.createdDate,"yyyy-MM-dd HH:mm")}},{title:"最后修改时间",field:"updateDate",templet:function(e){return e.updateDate?a.toDateString(e.updateDate,"yyyy-MM-dd HH:mm"):""}},{title:"状态",field:"status",templet:function(e){return 1===e.status?"启用":"停用"}}]],response:{statusCode:!0},parseData:function(e){return{code:e.success,msg:e.msg,data:e.data.rows}},done:function(e){var a,s;a=e.data.length,s=e.data.length,$("#currentKbAddressMountSpan").text(a),$("#kbAddressMountSpan").text(s)}}),r.on("radio",function(e){n(e.value)}),$("#createKbOrderBtn").on("click",e),$(".js-create-bb-address").on("click",s),$("#updateKbAddressBtn").on("click",t),$("#disabledKbAddressBtn").on("click",{type:0},l),$("#enabledKbAddressBtn").on("click",{type:1},l)});