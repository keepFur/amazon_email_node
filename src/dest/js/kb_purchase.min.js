"use strict";layui.use(["form","element","table","layer","util"],function(){var r=layui.form,o=layui.table,u=layui.layer,a=layui.util,d={netErrMsg:"系统已退出登录，请登录系统重试",operatorErrMsg:{single:"请选择一条数据操作",batch:"请至少选择一条数据操作"}};function e(e){return u.msg("成功"),!1}function t(e){var n=$("textarea[name=addressTo]").val();return n?u.open({content:'<form class="layui-form layui-form-pane" name="getRealOrderForm">\n                            <div class="layui-form-item">\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">过滤条件</label>\n                                    <div class="layui-input-block">\n                                        <textarea class="layui-textarea" placeholder="输入真实订单的收件人、手机号等信息进行过滤" name="condition"></textarea>\n                                    </div>\n                                </div>\n                            </div>\n                        </form>',title:"过滤真实订单",btn:["过滤","取消"],area:["450px"],yes:function(e){var a=$("textarea[name=condition]").val(),t=n.split("\n"),s=[];a?(u.msg("过滤成功"),u.close(e),s=t.filter(function(e){return e.match(a)}),$("textarea[name=addressTo]").val(s.join("\n"))):u.msg("过滤条件不能为空")}}):u.msg("请先填写收货地址信息"),!1}function s(e){var a,t=core.getFormValues($("form[name=kbOrderForm]")),s=(a=t)?a.kbCompany?a.addressFrom?a.addressTo?{isPass:!0,msg:""}:{isPass:!1,msg:"请输入收货地址"}:{isPass:!1,msg:"请选择发货地址"}:{isPass:!1,msg:"请选择快递类型"}:{isPass:!1,msg:"参数错误"};return s.isPass?(t.total=1e3,t.number=APIUtil.generateOrderNumer(),t.addressTo=t.addressTo.split(/\n/g).filter(function(e){return!!e}),$.ajax({url:"/api/createKbOrder",type:"POST",data:t,success:function(e,a,t){u.msg(e.success?"操作成功":"操作失败"),e.success&&core.setWindowHash("manage_kb_order")},error:function(e,a,t){u.msg(d.errorMsg)}})):u.msg(s.msg),!1}function n(e){return u.open({content:'<form class="layui-form layui-form-pane" name="kbAddressCreateForm">\n                            <div class="layui-form-item">\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">寄件人</label>\n                                    <div class="layui-input-block">\n                                        <input class="layui-input"  name="contact"/>\n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">手机号</label>\n                                    <div class="layui-input-block">\n                                        <input class="layui-input"  name="phone"/> \n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">邮编</label>\n                                    <div class="layui-input-block">\n                                        <input class="layui-input"  name="email"/> \n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">地址</label>\n                                    <div class="layui-input-block">\n                                        <textarea class="layui-textarea"  name="detail"></textarea>\n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">备注</label>\n                                    <div class="layui-input-block">\n                                        <input type="text" name="remark"  class="layui-input">\n                                    </div>\n                                </div>\n                            </div>\n                        </form>',title:"创建收货地址",btn:["创建","取消"],area:["450px"],yes:function(s){var e=core.getFormValues($("form[name=kbAddressCreateForm]")),a=m(e);a.isPass?$.ajax({url:"/api/createKbAddress",type:"POST",data:e,success:function(e,a,t){u.msg(e.success?"操作成功":"操作失败"),u.close(s),c(),p()},error:function(e,a,t){u.msg(d.errorMsg)}}):u.msg(a.msg)}}),!1}function l(e){var t=o.checkStatus("kbAddressTable").data;if(1===t.length){var a=t[0].contact,s=t[0].phone,n=t[0].detail,l=t[0].remark,i=t[0].email;u.open({content:'<form class="layui-form layui-form-pane" name="kbAddressUpdateForm" lay-filter="kbAddressUpdateForm">\n                            <div class="layui-form-item">\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">寄件人</label>\n                                    <div class="layui-input-block">\n                                        <input class="layui-input" value="'+a+'" name="contact" />\n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">手机号</label>\n                                    <div class="layui-input-block">\n                                        <input class="layui-input" value="'+s+'" name="phone"/>\n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">邮编</label>\n                                    <div class="layui-input-block">\n                                        <input class="layui-input" value="'+i+'" name="email"/>\n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">地址</label>\n                                    <div class="layui-input-block">\n                                        <textarea class="layui-textarea"  name="detail"></textarea>\n                                    </div>\n                                </div>\n                                <div class="layui-form-item layui-form-text">\n                                    <label class="layui-form-label">备注</label>\n                                    <div class="layui-input-block">\n                                        <input type="text" name="remark" value="'+l+'" class="layui-input">\n                                    </div>\n                                </div>\n                            </div>\n                        </form>',title:"收货地址信息修改",btn:["确定","取消"],area:["450px"],yes:function(s){var e=core.getFormValues($("form[name=kbAddressUpdateForm]")),a=m(e);e.id=t[0].id,a.isPass?$.ajax({url:"/api/updateKbAddress",type:"POST",data:e,success:function(e,a,t){u.msg(e.success?"操作成功":"操作失败"+e.message),u.close(s),c(),p()},error:function(e,a,t){u.msg(d.errorMsg)}}):u.msg(a.msg)},success:function(){r.val("kbAddressUpdateForm",{detail:n})}})}else u.msg(d.operatorErrMsg.single);return!1}function i(e){var a=o.checkStatus("kbAddressTable").data,t=e.data.type,s=0===t?"确定禁用吗？":"确定启用吗？";return 1===a.length?u.confirm(s,{btn:["确定","取消"],title:"询问框"},function(){$.ajax({url:"/api/toggleKbAddress",type:"POST",data:{id:a[0].id,status:t},success:function(e,a,t){u.msg(e.success?"操作成功":"操作失败"+e.message),c()},error:function(e,a,t){u.msg(d.netErrMsg)}})}):u.msg(d.operatorErrMsg.single),!1}function c(e){o.reload("kbAddressTable",e)}function m(e){return e?e.detail?e.contact?e.phone?e.email?{isPass:!0,msg:""}:{isPass:!1,msg:"邮编不能为空"}:{isPass:!1,msg:"手机号不能为空"}:{isPass:!1,msg:"联系人不能为空"}:{isPass:!1,msg:"详细地址不能为空"}:{isPass:!1,msg:"参数错误"}}function f(e){$.get("/api/readKbType?status=1&plant="+e,function(e){var a,t;a=e.data.rows,(t=$("select[name=kbCompany]")).empty(),t.append('<option value="">请选择快递类型</option>'),$.each(a,function(e,a){t.append('<option value="'+a.code+'">'+a.name+"</option>")}),r.render("select")},"json")}function p(){$.get("/api/readKbAddress?status=1",function(e){var a,t;a=e.data.rows,(t=$("select[name=addressFrom]")).empty(),t.append(' <option value="">请选择发货地址</option>'),$.each(a,function(e,a){t.append('<option value="'+a.detail+'">'+a.detail+" "+a.contact+" "+a.phone+" "+a.email+"</option>")}),r.render("select")},"json")}r.render("select"),r.render("radio"),f("TB"),p(),o.render({elem:"#kbAddressTable",url:"/api/readKbAddress",cols:[[{checkbox:!0},{title:"寄件人",field:"contact"},{title:"手机",field:"phone"},{title:"地址",field:"detail"},{title:"邮编",field:"email"},{title:"备注",field:"remark"},{title:"创建时间",field:"createdDate",templet:function(e){return a.toDateString(e.createdDate,"yyyy-MM-dd HH:mm")}},{title:"最后修改时间",field:"updateDate",templet:function(e){return e.updateDate?a.toDateString(e.updateDate,"yyyy-MM-dd HH:mm"):""}},{title:"状态",field:"status",templet:function(e){return 1===e.status?"启用":"停用"}}]],response:{statusCode:!0},parseData:function(e){return{code:e.success,msg:e.msg,data:e.data.rows}},done:function(e){var a,t;a=e.data.length,t=e.data.length,$("#currentKbAddressMountSpan").text(a),$("#kbAddressMountSpan").text(t)}}),r.on("radio",function(e){f(e.value)}),$("#formatAddressBtn").on("click",e),$("#getRealOrderBtn").on("click",t),$("#createKbOrderBtn").on("click",s),$(".js-create-bb-address").on("click",n),$("#updateKbAddressBtn").on("click",l),$("#disabledKbAddressBtn").on("click",{type:0},i),$("#enabledKbAddressBtn").on("click",{type:1},i),core.getUserInfoById(function(e){userInfo=e.data.rows[0],$("#userName").data("user",JSON.stringify(e)),$("#userBalance").text(core.fenToYuan(userInfo.money))})});