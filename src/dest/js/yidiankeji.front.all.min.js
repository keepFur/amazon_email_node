"use strict";var $=mdui.JQ;$(function(){var e,s="密码是由6-15位的数字或密码组成",t="用户名是由6-15位的数字或密码组成",a="电话是由11位的数字组成",n="计算结果不正确",i=0;function o(e){return $(".js-user-login").hasClass("mdui-hidden")&&($(this).addClass("li-selected").siblings().removeClass("li-selected"),$(".js-content,.front-footer").hide(),$(".js-user-register").hide().addClass("mdui-hidden"),$(".js-user-get-password").hide().addClass("mdui-hidden"),$(".js-user-set-password").hide().addClass("mdui-hidden"),$(".js-user-login").show().removeClass("mdui-hidden")),!1}function r(e){var s=f($("form[name=userLoginForm]")),i=h(s);if(i.isPass){if(s.computeResult!=$("input[name=loginProblem]").data("result"))return void mdui.snackbar({message:n,position:"top"});$.ajax({url:"/front/userLogin",method:"POST",data:s,success:function(e,s,i){(e=JSON.parse(e)).success?(mdui.snackbar({message:"登录成功",position:"top"}),window.location.assign("/console")):mdui.snackbar({message:"登录失败:"+e.message,position:"top"})},error:function(e,s,i){mdui.snackbar({message:"网络错误",position:"top"})}})}else mdui.snackbar({message:i.msg,position:"top"});return!1}function c(e){return $(".js-user-register").hasClass("mdui-hidden")&&($(this).addClass("li-selected").siblings().removeClass("li-selected"),$(".js-content,.front-footer").hide(),$(".js-user-login").hide().addClass("mdui-hidden"),$(".js-user-get-password").hide().addClass("mdui-hidden"),$(".js-user-register").show().removeClass("mdui-hidden")),!1}function u(){var e=f($("form[name=userRegisterForm]"));e.otherShareCode=k();var s=h(e);if(s.isPass)if(/^1[0-9]{10}$/.test(e.phone))if(e.verfiyCode.trim()){if($("input[name=phone]").data("code")===e.verfiyCode.trim())return 1===++i&&$.ajax({url:"/front/createUser",method:"POST",data:e,success:function(e,s,i){(e=JSON.parse(e)).success?(mdui.snackbar({message:"注册成功",position:"top"}),window.location.assign("/console")):mdui.snackbar({message:"注册失败:"+e.message,position:"top"})},error:function(e,s,i){mdui.snackbar({message:"网络错误，请刷新页面重试",position:"top"})},complete:function(){i=0}}),!1;mdui.snackbar({message:"验证码错误",position:"top"})}else mdui.snackbar({message:"请输入验证码",position:"top"});else mdui.snackbar({message:a,position:"top"});else mdui.snackbar({message:s.msg,position:"top"})}function d(e){return $(".js-user-get-password").hasClass("mdui-hidden")&&($(this).addClass("li-selected").siblings().removeClass("li-selected"),$(".js-content,.front-footer").hide(),$(".js-user-login").hide().addClass("mdui-hidden"),$(".js-user-get-password").show().removeClass("mdui-hidden")),!1}function m(e){var s=f($("form[name=userGetPasswordForm]")),i=$("input[name=userPhone]").data("code"),n=/^[a-zA-Z0-9]{6,15}$/g.test(s.userName)?s.verfiyCode!==i?{isPass:!1,msg:"验证码错误"}:{isPass:!0,msg:"验证通过"}:{isPass:!1,msg:t};if(n.isPass)return $.ajax({url:"/front/getUserInfoByPhone",data:s,dataType:"json",success:function(e){e.success?(mdui.snackbar({message:"信息校验成功",position:"top"}),$(".js-user-set-password").show().removeClass("mdui-hidden"),$(".js-user-login").hide().addClass("mdui-hidden"),$(".js-user-get-password").hide().addClass("mdui-hidden"),$(".js-user-register").hide().addClass("mdui-hidden"),$("form[name=userSetPasswordForm] input[name=userName]").val(s.userName)):mdui.snackbar({message:e.msg,position:"top"})}}),!1;mdui.snackbar({message:n.msg,position:"top"})}function l(e){var s,i,n=(s=Math.ceil(14*Math.random()),i=Math.ceil(14*Math.random()),{num1:s,num2:i,ret:s+i});return $("input[name=loginProblem]").val(n.num1+"+"+n.num2+"=").data("result",n.ret),!1}function g(e){var s=e._data.$userPhone,i=s.val().trim(),n=$(this),t=null,o=60;return/^1[0-9]{10}$/.test(i)?$.ajax({url:"/front/getVerfiyCode",data:{userPhone:i},dataType:"json",beforeSend:function(){n.text("发送中...").attr("disabled",!0)},success:function(e){e.success?(mdui.snackbar({message:"验证码获取成功",position:"top"}),s.data("code",e.code),t=setInterval(function(){--o<=0?(n.text("重新获取").removeAttr("disabled"),o=60,clearInterval(t)):n.text(o+"s 之后重新获取").attr("disabled",!0).css("color","#000")},1e3)):mdui.snackbar({message:"验证码获取失败:"+e.msg,position:"top"})},error:function(e){mdui.snackbar({message:"网络错误，请刷新页面重试",position:"top"})},complete:function(){console.log("已发送"),n.text("获取验证码").removeAttr("disabled")}}):mdui.snackbar({message:a,position:"top"}),!1}function p(e){var s=f($("form[name=userSetPasswordForm]")),i=h(s);if(i.isPass)return $.ajax({url:"/front/setUserPassword",method:"POST",data:s,dataType:"json",success:function(e){e.success?(mdui.snackbar({message:"密码重置成功："+e.message,position:"top"}),$("#userLogin").trigger("click")):mdui.snackbar({message:"密码重置失败："+e.message,position:"top"})},error:function(e){mdui.snackbar({message:"网络错误，请刷新页面重试",position:"top"})}}),!1;mdui.snackbar({message:i.msg,position:"top"})}function f(e){var s={};return e&&e.length?(e.serializeArray().forEach(function(e){s[e.name]=$.trim(e.value)},this),s):{}}function h(e){return e?/^[a-zA-Z0-9]{6,15}$/g.test(e.userName)?/^[a-zA-Z0-9@]{6,15}$/g.test(e.password)?{isPass:!0,msg:"校验通过"}:{isPass:!1,msg:s}:{isPass:!1,msg:t}:{isPass:!1,msg:"参数错误"}}function k(){return e="otherShareCode",s=window.location.href,i=new RegExp(e+"=([^&|#?]+)"),null!==(n=s.substring(s.indexOf("?")+1).match(i))?window.unescape(n[1]):null;var e,s,i,n}$.ajax({url:"/front/readNoticePage",data:{limit:5,offset:1},dataType:"json",success:function(e){var t=$(".js-notice-container");e.success?0===e.data.rows.length?t.append('<a href="#">暂无公告</a>'):($.each(e.data.rows,function(e,s){var i=function(e,s){"string"!=typeof e&&(e="yyyy-mm-dd hh:MM:ss");var i,n=function(e){return"string"==typeof e},t=function(e){return 10<=e?e:"0"+e};return s={year:(i=n(i=s)?new Date(i):i||new Date).getFullYear(),month:i.getMonth()+1,day:i.getDate(),hours:i.getHours(),minutes:i.getMinutes(),seconds:i.getSeconds()},e.replace(/yyyy/gi,s.year).replace(/mm/,t(s.month)).replace(/dd/gi,t(s.day)).replace(/hh/gi,t(s.hours)).replace(/MM/,t(s.minutes)).replace(/ss/gi,t(s.seconds))}("yyyy-mm-dd HH:MM",s.createdDate),n='<a href="#" class="pull-left text-ellipsis js-notice-item '+(0===e?" js-notice-item-active":" hide")+'" data-id="'+s.id+'">\n                                        <span class="js-notice-title">'+i+"#"+s.noticeTitle+'</span>\n                                        <span class="js-notice-content">'+s.noticeContent+"</span>\n                                     </a>";t.append(n)}),setInterval(function(){var e=$(".js-notice-item"),s=e.length,i=$(".js-notice-item-active"),n=e.index(i[0]);n===s-1&&(n=-1),i.removeClass("js-notice-item-active").addClass("hide"),e.eq(n+1).addClass("js-notice-item-active").removeClass("hide")},1e4)):t.append('<a href="#">暂无公告</a>')}}),function(){function s(e,i){e&&e.forEach(function(e,s){e.className=i})}var i=document.querySelectorAll(".ad .control>li"),n=document.querySelectorAll(".ad .item");i.forEach(function(e){e.addEventListener("click",function(){var e=parseInt(this.getAttribute("data-index"));s(i,""),s([this],"active"),s(n,"item hide"),s([n[e]],"item show")})})}(),e=null,$(".js-notice-view-more").on("click",function(e){return!1}),$("#home").on("click",function(){return $(".js-user-login").hasClass("mdui-hidden")&&$(".js-user-register").hasClass("mdui-hidden")||window.location.reload(),!1}),$("#kbPur").on("click",function(){return $.ajax({url:"/front/getUserLoginStatus",success:function(e){(e=JSON.parse(e)).status?window.location.assign("/console#kb_purchase"):(mdui.snackbar({message:"请先登录系统",position:"top"}),$("#userLogin").trigger("click"))}}),!1}),$(".jsTrafficPur").on("click",function(){return $.ajax({url:"/front/getUserLoginStatus",success:function(e){(e=JSON.parse(e)).status?window.location.assign("/console#task_create"):(mdui.snackbar({message:"请先登录系统",position:"top"}),$("#userLogin").trigger("click"))}}),!1}),$("#userRegister").on("click",c),$(".js-to-login").on("click",function(){$("#userLogin").trigger("click")}),$("#userRegisterSubmit").on("click",u),$("#userLogin").on("click",o),$(".js-login-to-register").on("click",function(){$("#userRegister").trigger("click")}),$("#userLoginSubmit").on("click",r),$("#getUserPassword").on("click",d),$("#getUserPasswordSubmit").on("click",m),$("#getVerfiyCode").on("click",{$userPhone:$("input[name=userPhone]")},g),$("#getVerfiyCodeReg").on("click",{$userPhone:$("input[name=phone]")},g),$("#refreshCompute").on("click",l),$("#setUserPasswordSubmit").on("click",p),$("#console,.big-img").on("click",function(e){return $.ajax({url:"/front/getUserLoginStatus",success:function(e){(e=JSON.parse(e)).status?window.location.assign("/console"):(mdui.snackbar({message:"请先登录系统",position:"top"}),$("#userLogin").trigger("click"))}}),!1}),$("#addMoney").on("click",function(e){$.ajax({url:"/front/getUserLoginStatus",success:function(e){(e=JSON.parse(e)).status?window.location.assign("/console#add_money"):(mdui.snackbar({message:"请先登录系统",position:"top"}),$("#userLogin").trigger("click"))}})}),$(".kefu-container").on("click",function(){return(e=new mdui.Dialog(".js-kefu-mdui-dialog")).open(),!1}),$(".kefu-btn-no").on("click",function(){return e.close(),!1}),$("#userLoginFooter,.buy").on("click",function(e){var s=$(this);return $.ajax({url:"/front/getUserLoginStatus",success:function(e){(e=JSON.parse(e)).status?window.location.assign(s.find("a").attr("href")):(mdui.snackbar({message:"请先登录系统",position:"top"}),$("#userLogin").trigger("click"))}}),!1}),$("#refreshCompute").trigger("click"),new mdui.Tooltip($(".js-notice-view-more"),{position:"auto",content:"更多公告，请登录系统查看，谢谢！！！祝老板每天爆单"}),k()&&$("#userRegister").trigger("click"),$.trim=function(e){return(e=e||"").replace(/^\s*|\s*$/g,"")}});