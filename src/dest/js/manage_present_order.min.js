"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}layui.use(["element","table","layer","util","form","laydate"],function(){layui.element;var e,n,s=layui.table,d=layui.layer,t=layui.util,i=layui.form,r=layui.laydate,o={netErrMsg:"系统已退出登录，请登录系统重试",operatorErrMsg:{single:"请选择一条数据操作",batch:"请至少选择一条数据操作"}};function a(e){var t=f();return t.createdDateStart=t.createdDate.split("~")[0],t.createdDateEnd=t.createdDate.split("~")[1],g($.extend(t,{page:{curr:1,limit:10}})),!1}function l(e){return $(".flyer-layout-tree .flyer-layout-link[data-hash=present_purchase]").click(),!1}function c(){var e=document.createElement("a");return e.href="/api/exportPresentOrderToExcel?limit=1000&offset=1&status=1",e.click(),!1}function u(e){var t=document.createElement("a"),r=f();return r.stockFromId?(t.href="/api/downloadPresentOrderToExcel?limit=1000&offset=1&"+core.objectToString(r),t.click(),setTimeout(function(){g()},2e3)):d.msg("请选择发货仓库"),!1}function m(e){var t=document.createElement("a");return t.href="/api/pddBatch?limit=1000&offset=1&plant=PDD&status=1",t.click(),!1}function p(e){var r=s.checkStatus("presentOrderTable").data,a=e.data.type,t=2===a?"确定标记为已扫描状态吗？":"确定标记为取消状态吗？";return 3===a&&1!==r.length?d.msg(o.operatorErrMsg.single):3===a&&2===r[0].status?d.msg("已扫描的订单不能取消！！！"):3===a&&3===r[0].status?d.msg("该订单已经是取消状态了！！！"):0<r.length?d.confirm(t,{title:"询问框",btn:["确定","取消"]},function(e,t){$.ajax({url:"/api/togglePresentOrder",type:"POST",data:{id:r.map(function(e){return e.id}),status:a,count:r[0].total,number:r[0].orderNumber,userId:r[0].userId,userName:r[0].userName},success:function(e,t,r){d.msg(e.success?"操作成功！":"操作失败："+e.message),g()},error:function(e,t,r){d.msg(o.netErrMsg)}})}):d.msg(o.operatorErrMsg.batch),!1}function f(){var e=$("#presentOrderSearchForm").serializeArray(),r={};return $.each(e,function(e,t){r[t.name]=t.value}),r.createdDateStart=r.createdDate.split("~")[0],r.createdDateEnd=r.createdDate.split("~")[1],r}function g(e){s.reload("presentOrderTable",{where:e})}i.render("select"),r.render({elem:"#createdDate",range:"~"}),core.getUserInfoById(function(e){e.data.rows[0].isSuper||$(".js-super").remove()}),s.render((_defineProperty(e={elem:"#presentOrderTable",url:"/api/readPresentOrderPage",page:!0,where:{},cols:[[{checkbox:!0,fixed:"left"},{field:"",title:"序号",fixed:"left",templet:function(e){return e.LAY_INDEX}},{field:"userName",title:"下单用户",width:150},{field:"orderNumber",title:"订单号",width:220},{field:"kdNumber",title:"快递单号",width:220},{field:"fromStockId",title:"快递仓库/发货地址",width:300,templet:function(e){return e.name+"/"+e.address}},{field:"addressFromName",title:"发件人信息",width:200,templet:function(e){return e.addressFromName+"("+e.addressFromPhone+")"}},{field:"addressTo",title:"收件人信息",width:300},{field:"remark",title:"备注",width:150},{field:"createdDate",title:"创建时间",width:200,templet:function(e){return t.toDateString(e.createdDate,"yyyy-MM-dd HH:mm")}},{field:"status",title:"状态",width:200,fixed:"right",align:"center",templet:function(e){return'<span class="layui-text-'+(1==e.status?"green":"pink")+'">'+["","待扫描","已扫描","已取消"][e.status]+"</span> "+(1===e.status?'<a class="layui-btn layui-btn-normal layui-btn-xs js-update-order" data-id="'+e.id+'"  data-kb-to="'+e.addressTo+'">修改</a>':"")}}]],limits:[10,20,50,100]},"page",{theme:"#1E9FFF",layout:["prev","page","next","skip","count","limit"]}),_defineProperty(e,"request",{pageName:"offset"}),_defineProperty(e,"response",{statusCode:!0}),_defineProperty(e,"parseData",function(e){return{code:e.success,msg:e.msg,count:e.data.total,data:e.data.rows}}),_defineProperty(e,"done",function(){$(".js-update-order").off("click").on("click",function(e){$(this).data("kb-from");var t=$(this).data("kb-to"),i=$(this).data("id");return d.open({content:'<form class="layui-form" name="presentOrderUpdateForm" lay-filter="presentOrderUpdateForm">\n                                    <div class="layui-form-item">\n                                        <label class="layui-form-label">收货地址</label>\n                                        <div class="layui-input-block">\n                                            <input class="layui-input" name="addressTo" value="'+t+'" placeholder="" />\n                                        </div>\n                                    </div>\n                                </form>',area:["600px","300px"],title:"礼品订单信息修改",btn:["保存","取消"],yes:function(a){var e,t,r,n=core.getFormValues($("form[name=presentOrderUpdateForm]")),s=(r=n)?r.addressTo?{isPass:!0,msg:""}:{isPass:!1,msg:"请输入收货地址"}:{isPass:!1,msg:"参数错误"};s.isPass?(n.id=i,n.addressToPca=(e=n.addressTo.split(/,|，/)[2],(t=e.split(" "))[0]+"-"+t[1]+"-"+t[2]),$.ajax({url:"/api/updatePresentOrder",type:"POST",data:n,success:function(e,t,r){d.msg(e.success?"操作成功":"操作失败"+e.message),d.close(a),g()},error:function(e,t,r){d.msg(o.errorMsg)}})):d.msg(s.msg)}}),!1})}),e)),$("#searchBtn").on("click",a),$("#resetBtn").on("click",function(){return $("#presentOrderSearchForm")[0].reset(),!1}),$("#createPresentOrderBtn").on("click",l),$("#exportPresentOrderBtn").on("click",c),$("#downloadPresentOrderBtn").on("click",u),$("#pddBatchBtn").on("click",m),$("#cancelPresentOrderBtn").on("click",{type:3},p),$("#markScanedPresentOrderBtn").on("click",{type:2},p),$.get("/api/readFromStock?status=1",function(e){var t,r,a;t=e.data.rows,r=n,(a=$("select[name=stockFromId]")).empty(),a.append('<option value="">请选择发货仓库</option>'),$.each(t,function(e,t){a.append('<option value="'+t.id+'" data-address="'+t.address+'" '+(r==t.id?"selected":"")+">"+t.name+" "+t.address+"</option>")}),i.render("select")},"json")});