"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}layui.use(["form","element","layer","table","util"],function(){var e,t=layui.form,r=(layui.element,layui.layer),s=layui.table,n=layui.util,i={$table:null,paramErrMsg:"参数错误，请刷新页面重试",netErrMsg:"系统已退出登录，请登录系统重试",operatorErrMsg:{single:"请选择一条数据操作",batch:"请至少选择一条数据操作"}},a='<form class="layui-form layui-form-pane" name="userUpdateForm">\n                                <div class="layui-form-item">\n                                    <label class="layui-form-label">手机</label>\n                                    <div class="layui-input-block">\n                                        <input type="text" name="phone" placeholder="非必填" class="layui-input">\n                                    </div>\n                                </div>\n                                <div class="layui-form-item">\n                                    <label class="layui-form-label">邮箱</label>\n                                    <div class="layui-input-block">\n                                        <input type="text" name="email" placeholder="非必填" class="layui-input">\n                                    </div>\n                                </div>\n                                <div class="layui-form-item">\n                                    <label class="layui-form-label">QQ</label>\n                                    <div class="layui-input-block">\n                                        <input type="text" name="QQ"  placeholder="非必填" class="layui-input">\n                                    </div>\n                                </div>\n                            </form>';function l(e){var t,n;return f({where:(t=$("#userSearchForm").serializeArray(),n={},$.each(t,function(e,t){n[t.name]=t.value}),n),page:{curr:1,limit:10}}),!1}function u(e){return r.msg(" 请前往首页注册！！"),!1}function o(e){var t=s.checkStatus("userTable").data;return 1===t.length?r.open({content:a,area:["440px"],title:"修改用户「"+t[0].userName+"」",btn:["修改","取消"],yes:function(a){var e=core.getFormValues($("form[name=userUpdateForm]"));e.id=t[0].id,$.ajax({url:"/api/updateUser",type:"POST",data:e,success:function(e,t,n){r.msg(e.success?"操作成功":"操作失败"),r.close(a),f()},error:function(e,t,n){r.msg(i.errorMsg)}})},success:function(){!function(e,t){if(!e||!t)return $.writeLog("manage_user-setUserInfo","表单元素或表单信息为空");for(var n in t)if(t.hasOwnProperty(n)){var a=t[n];e.find("input[name="+n+"]").val(a)}}($("form[name=userUpdateForm]"),t[0])}}):r.msg(i.operatorErrMsg.single),!1}function c(e){var n=s.checkStatus("userTable").data;return 1===n.length?r.open({content:'<form class="layui-form layui-form-pane">\n                                <div class="layui-form-item">\n                                    <label class="layui-form-label">充值金额</label>\n                                    <div class="layui-input-block">\n                                        <input type="text" name="money" placeholder="只能是正整数，最少10元"  class="layui-input">\n                                    </div>\n                                </div>\n                            </form>',area:["400px"],title:"余额充值",btn:["充值","取消"],yes:function(a){var e=$.trim($("input[name=money]").val()),t=function(e){if(!e)return{isPass:!1,msg:"请输入充值金额"};if(e<1e3)return{isPass:!1,msg:"充值金额不能小于1000分"};if(isNaN(e))return{isPass:!1,msg:"充值金额只能是正整数"};return{isPass:!0,msg:""}}(e);t.isPass?$.ajax({url:"/api/userAddMoney",type:"POST",data:{money:e,id:n[0].id},success:function(e,t,n){r.msg(e.success?"操作成功":"操作失败"+e.message),r.close(a),f()},error:function(e,t,n){r.msg(i.errorMsg)}}):r.msg(t.msg)}}):r.msg(i.operatorErrMsg.single),!1}function m(e){var n=s.checkStatus("userTable").data;return 1===n.length?function(e,t){if(!e)return"function"==typeof t&&t({success:!1,message:"用户id不能为空"});$.ajax({url:"/api/readUserById",data:{id:e},success:function(e){t(e)},error:function(e){t(data)}})}(n[0].id,function(e){if(e.success){var t=e.data.rows[0].money;1e3<=t?r.confirm('<span style="color:#f00;">确定升级吗？</br>升级之后可以享受<strong>九折</strong>优惠!</br>升级会从账户中抵扣1000元，</br>请确保账户中有足够的余额！</span>',{btn:["确定","取消"],title:"询问框"},function(){$.ajax({url:"/api/updateLevelUser",type:"POST",data:{id:n[0].id,level:2},success:function(e,t,n){r.msg(e.success?"操作成功":"操作失败"+e.message),f()},error:function(e,t,n){r.msg(i.netErrMsg)}})}):r.msg("您的余额不足1000， 请充值之后再升级。当前余额是 "+t+" 元!")}else r.msg(e.message)}):r.msg(i.operatorErrMsg.single),!1}function d(e){var t=s.checkStatus("userTable").data,n=e.data.type,a=0===n?"确定禁用吗？":"确定启用吗？";return 1===t.length?r.confirm(a,{btn:["确定","取消"],title:"询问框"},function(){$.ajax({url:"/api/toggleUser",type:"POST",data:{id:t[0].id,status:n},success:function(e,t,n){r.msg(e.success?"操作成功":"操作失败"+e.message),f()},error:function(e,t,n){r.msg(i.netErrMsg)}})}):r.msg(i.operatorErrMsg.single),!1}function f(e){s.reload("userTable",e)}t.render("select"),s.render((_defineProperty(e={elem:"#userTable",url:"/api/readUserPage",page:!0,cols:[[{checkbox:!0},{title:"用户名",field:"userName"},{title:"当前余额",field:"money"},{title:"等级",field:"level",templet:function(e){return 1===e.level?"普通":"金牌"}},{title:"邮箱",field:"email",templet:function(e){return e.email?e.email:""}},{title:"电话",field:"phone",templet:function(e){return e.phone?e.phone:""}},{title:"QQ",field:"QQ",templet:function(e){return e.QQ?e.QQ:""}},{title:"注册时间",field:"createdDate",templet:function(e){return n.toDateString(e.createdDate,"yyyy-MM-dd HH:mm")}},{title:"最后修改时间",field:"updateDate",templet:function(e){return e.updateDate?n.toDateString(e.updateDate,"yyyy-MM-dd HH:mm"):""}},{title:"状态",field:"status",templet:function(e){return 1===e.status?"启用":"停用"}}]],limits:[10,20,50,100]},"page",{theme:"#1E9FFF",layout:["prev","page","next","skip","count","limit"]}),_defineProperty(e,"request",{pageName:"offset"}),_defineProperty(e,"response",{statusCode:!0}),_defineProperty(e,"parseData",function(e){return{code:e.success,msg:e.msg,count:e.data.total,data:e.data.rows}}),_defineProperty(e,"done",function(e){}),e)),$("#searchBtn").on("click",l),$("#resetBtn").on("click",function(){return $("#userSearchForm")[0].reset(),!1}),$("#createUserBtn").on("click",u),$("#updateUserBtn").on("click",o),$("#addMoneyUserBtn").on("click",c),$("#updateLevelUserBtn").on("click",m),$("#disabledUserBtn").on("click",{type:0},d),$("#enabledUserBtn").on("click",{type:1},d)});