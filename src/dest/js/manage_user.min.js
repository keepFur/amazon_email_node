"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}layui.use(["form","element","layer","table","util"],function(){var e,t=layui.form,i=(layui.element,layui.layer),s=layui.table,l=layui.util,r={$table:null,paramErrMsg:"参数错误，请刷新页面重试",netErrMsg:"系统已退出登录，请登录系统重试",operatorErrMsg:{single:"请选择一条数据操作",batch:"请至少选择一条数据操作"}},a='<form class="layui-form layui-form-pane" name="userUpdateForm">\n                                <div class="layui-form-item">\n                                    <label class="layui-form-label">手机</label>\n                                    <div class="layui-input-block">\n                                        <input type="text" name="phone" placeholder="非必填" class="layui-input">\n                                    </div>\n                                </div>\n                                <div class="layui-form-item">\n                                    <label class="layui-form-label">邮箱</label>\n                                    <div class="layui-input-block">\n                                        <input type="text" name="email" placeholder="非必填" class="layui-input">\n                                    </div>\n                                </div>\n                                <div class="layui-form-item">\n                                    <label class="layui-form-label">QQ</label>\n                                    <div class="layui-input-block">\n                                        <input type="text" name="QQ"  placeholder="非必填" class="layui-input">\n                                    </div>\n                                </div>\n                            </form>';function n(e){var t,a;return f({where:(t=$("#userSearchForm").serializeArray(),a={},$.each(t,function(e,t){a[t.name]=t.value}),a),page:{curr:1,limit:10}}),!1}function u(e){return i.msg(" 请前往首页注册！！"),!1}function o(e){var t=s.checkStatus("userTable").data;return 1===t.length?i.open({content:a,area:["440px"],title:"修改用户「"+t[0].userName+"」",btn:["修改","取消"],yes:function(n){var e=core.getFormValues($("form[name=userUpdateForm]"));e.id=t[0].id,$.ajax({url:"/api/updateUser",type:"POST",data:e,success:function(e,t,a){i.msg(e.success?"操作成功":"操作失败"),i.close(n),f()},error:function(e,t,a){i.msg(r.errorMsg)}})},success:function(){!function(e,t){if(!e||!t)return $.writeLog("manage_user-setUserInfo","表单元素或表单信息为空");for(var a in t)if(t.hasOwnProperty(a)){var n=t[a];e.find("input[name="+a+"]").val(n)}}($("form[name=userUpdateForm]"),t[0])}}):i.msg(r.operatorErrMsg.single),!1}function c(e){var a=s.checkStatus("userTable").data;return 1===a.length?i.open({content:'<form class="layui-form layui-form-pane">\n                                <div class="layui-form-item">\n                                    <label class="layui-form-label">金额（分）</label>\n                                    <div class="layui-input-block">\n                                        <input type="text" name="money" placeholder="单位为分，只能是正整数，最少10元"  class="layui-input">\n                                    </div>\n                                </div>\n                            </form>',area:["400px"],title:"余额充值（单位：分）",btn:["充值","取消"],yes:function(n){var e=$.trim($("input[name=money]").val()),t=function(e){if(!e)return{isPass:!1,msg:"请输入充值金额"};if(e<100)return{isPass:!1,msg:"充值金额不能小于10元"};if(isNaN(e))return{isPass:!1,msg:"充值金额只能是正整数"};return{isPass:!0,msg:""}}(e);t.isPass?$.ajax({url:"/api/userAddMoney",type:"POST",data:{money:e,id:a[0].id,userName:a[0].userName,balance:a[0].money},success:function(e,t,a){i.msg(e.success?"操作成功":"操作失败"+e.message),i.close(n),f()},error:function(e,t,a){i.msg(r.errorMsg)}}):i.msg(t.msg)}}):i.msg(r.operatorErrMsg.single),!1}function d(e){var a=s.checkStatus("userTable").data;return 1===a.length?function(e,t){if(!e)return"function"==typeof t&&t({success:!1,message:"用户id不能为空"});$.ajax({url:"/api/readUserById",data:{id:e},success:function(e){t(e)},error:function(e){t(data)}})}(a[0].id,function(e){if(e.success){var t=e.data.rows[0].money;1e3<=t?i.confirm('<span style="color:#f00;">确定升级吗？</br>升级之后可以享受<strong>九折</strong>优惠!</br>升级会从账户中抵扣1000元，</br>请确保账户中有足够的余额！</span>',{btn:["确定","取消"],title:"询问框"},function(){$.ajax({url:"/api/updateLevelUser",type:"POST",data:{id:a[0].id,userName:a[0].userName,money:a[0].money,level:2},success:function(e,t,a){i.msg(e.success?"操作成功":"操作失败"+e.message),f()},error:function(e,t,a){i.msg(r.netErrMsg)}})}):i.msg("您的余额不足1000， 请充值之后再升级。当前余额是 "+t+" 元!")}else i.msg(e.message)}):i.msg(r.operatorErrMsg.single),!1}function m(e){var t=s.checkStatus("userTable").data,a=e.data.type,n=0===a?"确定禁用吗？":"确定启用吗？";return 1===t.length?i.confirm(n,{btn:["确定","取消"],title:"询问框"},function(){$.ajax({url:"/api/toggleUser",type:"POST",data:{id:t[0].id,status:a},success:function(e,t,a){i.msg(e.success?"操作成功":"操作失败"+e.message),f()},error:function(e,t,a){i.msg(r.netErrMsg)}})}):i.msg(r.operatorErrMsg.single),!1}function f(e){s.reload("userTable",e)}t.render("select"),s.render((_defineProperty(e={elem:"#userTable",url:"/api/readUserPage",page:!0,cols:[[{checkbox:!0,fixed:"left"},{field:"",title:"序号",width:60,fixed:"left",templet:function(e){return e.LAY_INDEX}},{title:"用户名",field:"userName",fixed:"left",width:150},{title:"当前余额（元）",field:"money",width:150,templet:function(e){return core.fenToYuan(e.money)}},{title:"等级",field:"level",width:150,templet:function(e){return 1===e.level?"普通":"金牌"}},{title:"邮箱",field:"email",width:150,templet:function(e){return e.email?e.email:""}},{title:"电话",field:"phone",width:150,templet:function(e){return e.phone?e.phone:""}},{title:"QQ",field:"QQ",width:150,templet:function(e){return e.QQ?e.QQ:""}},{title:"注册时间",width:200,field:"createdDate",templet:function(e){return l.toDateString(e.createdDate,"yyyy-MM-dd HH:mm")}},{title:"最后修改时间",field:"updateDate",width:200,templet:function(e){return e.updateDate?l.toDateString(e.updateDate,"yyyy-MM-dd HH:mm"):""}},{title:"状态",field:"status",width:120,fixed:"right",templet:function(e){return 1===e.status?"启用":'<span class="layui-text-pink">停用</span>'}},{title:"操作",field:"",width:150,fixed:"right",templet:function(e){return'<a class="layui-btn layui-btn-normal layui-btn-xs js-view-extend" data-username="'+e.userName+'" data-id="'+e.id+'" data-othersharecode="'+e.otherShareCode+'" data-mysharecode="'+e.myShareCode+'">推广详情</a>'}}]],limits:[10,20,50,100]},"page",{theme:"#1E9FFF",layout:["prev","page","next","skip","count","limit"]}),_defineProperty(e,"request",{pageName:"offset"}),_defineProperty(e,"response",{statusCode:!0}),_defineProperty(e,"parseData",function(e){return{code:e.success,msg:e.msg,count:e.data.total,data:e.data.rows}}),_defineProperty(e,"done",function(e){$(".js-view-extend").off("click").on("click",function(e){var t=$(this).data("username"),a=$(this).data("id"),n=$(this).data("othersharecode")||"",r=$(this).data("mysharecode");$.ajax({url:"/api/readUserExtendDetailById",data:{id:a,otherShareCode:n},success:function(a){a.success?i.open({content:'<div>\n                                                <h5 class="layui-text-green">推广概览</h5>\n                                                <div class="layui-row layui-anim layui-anim-up layui-anim-fadein layui-anim-rotate" style="margin-bottom:16px;">\n                                                    <div class="layui-col-md6 home-account-info" style="padding:8px;">\n                                                        <h3 class="pull-left">注册来源：<span class="layui-text-pink js-user-register">0</span></h3>\n                                                    </div>\n                                                    <div class="layui-col-md6 home-account-info" style="padding:8px;">\n                                                        <h3 class="pull-left">佣金总额：<span class="layui-text-pink js-user-extend-money">0</span></h3>\n                                                    </div>\n                                                  </div>\n                                                  <h5 class="layui-text-green">下级代理</h5>\n                                                  <div lay-filter=\'userExtend\' id="userExtendTable"></div>\n                                                </div>',area:["800px","600px"],title:"用户【"+t+"】推广详情",btn:["关闭"],yes:function(e){i.close(e)},success:function(){var e,t;e=r,s.render((_defineProperty(t={elem:"#userExtendTable",url:"/api/readShareUserPage",page:!0,where:{myShareCode:e},cols:[[{title:"用户名",field:"userName"},{title:"当前余额（元）",field:"money",width:150,templet:function(e){return core.fenToYuan(e.money)}},{title:"等级",field:"level",width:100,templet:function(e){return 1===e.level?"普通":"金牌"}},{title:"注册时间",width:200,field:"createdDate",templet:function(e){return l.toDateString(e.createdDate,"yyyy-MM-dd HH:mm")}},{title:"状态",field:"status",width:100,templet:function(e){return 1===e.status?"启用":'<span class="layui-text-pink">停用</span>'}}]],limits:[10,20,50,100]},"page",{theme:"#1E9FFF",layout:["prev","page","next","skip","count","limit"]}),_defineProperty(t,"request",{pageName:"offset"}),_defineProperty(t,"response",{statusCode:!0}),_defineProperty(t,"parseData",function(e){return{code:e.success,msg:e.msg,count:e.data.total,data:e.data.rows}}),t)),$(".js-user-register").text(a.data.registerOrigin),$(".js-user-extend-money").text(core.fenToYuan(a.data.extendMoney||0)+"元")}}):(console.log(a.message),i.msg("服务器出现异常，请刷新页面重试！"))},error:function(e){i.msg("服务器出现异常，请刷新页面重试！")}})})}),e)),$("#searchBtn").on("click",n),$("#resetBtn").on("click",function(){return $("#userSearchForm")[0].reset(),!1}),$("#createUserBtn").on("click",u),$("#updateUserBtn").on("click",o),$("#addMoneyUserBtn").on("click",c),$("#updateLevelUserBtn").on("click",d),$("#disabledUserBtn").on("click",{type:0},m),$("#enabledUserBtn").on("click",{type:1},m)});