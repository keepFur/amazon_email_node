"use strict";function _defineProperty(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}layui.use(["element","layer","form","table","util"],function(){layui.element;var o=layui.layer,n=layui.form,r=layui.table,c=layui.util,i=.1,d=.05,s="",u="";function l(e){var a=$(e),t=a.data("purchase-score"),n=a.data("present-score"),r=t+n,o=a.data("purchase-money")+a.data("present-money"),c=o/d,s=o/i;$("#purchaseMoney").text(core.numberToLocalString(o)),$("#purchaseScore").text(core.numberToLocalString(r)),$("#trafficCount").text(core.numberToLocalString(c)),$("#collectCount").text(core.numberToLocalString(s)),$("#addScore").text(core.numberToLocalString(t)+"购买积分+"+core.numberToLocalString(n)+"赠送积分"),$("#payMoney").text(core.numberToLocalString(a.data("purchaseMoney")))}function e(e){var a=$("input[type=radio][name=addPackageType]:checked"),r={};o.open({content:'<div class="js-pay-container">\n                            <h3 style="text-align:center;">打开微信或者支付宝扫一扫即可付款</h3>\n                            <div>\n                                <img width="100%" height="330" alt="付款码" id="jsPayCodeImg">\n                                <button class="layer-btn layer-btn-normal" id="jsPayCodeRefresh" style="display:none;">刷新</button>\n                            </div>\n                            <div>\n                                <span class="pull-left">付款金额：<spam id="payMount">100</spam>元</span>\n                                <span class="pull-right">收款人：易店科技</span>\n                            </div>\n                        </div>',area:["450px","520px"],title:"在线充值付款",btn:"支付完成",scrollbar:!1,yes:function(e,a){r.payStatus||y(r.qr_id,r.addPackageType,function(e){o.closeAll("msg"),e?(o.msg("支付成功"),core.setWindowHash("manage_logs"),window.location.reload(!0)):o.msg("订单未支付")})},cancel:function(){r.payStatus||y(r.qr_id,r.addPackageType,function(e){o.closeAll("msg"),e?(o.msg("支付成功"),core.setWindowHash("manage_logs"),window.location.reload(!0)):o.msg("订单未支付")})},success:function(t,n){$("#payMount").text(a.data("purchase-money")/100),$.ajax({url:"/api/createQrCode",type:"POST",data:{qr_name:"余额充值",packageId:a.val(),qr_type:"QR_TYPE_NOLIMIT"},beforeSend:function(){$.addLoading($(".js-pay-container"))},success:function(e){if($("#jsPayCodeImg").toggle(e.success),$("#jsPayCodeRefresh").toggle(!e.success),e.success){$("#jsPayCodeImg").attr("src",e.data.qr_code),r.qr_id=e.data.qr_id,r.addPackageType=$("input[type=radio][name=addPackageType]:checked").val();var a=0;r.timer=setInterval(function(){$.lockedBtn(t.find(".layui-layer-btn0"),!0,"支付状态检测中"),++a<5?y(r.qr_id,r.addPackageType,function(e){o.closeAll("msg"),e?(r.payStatus=!0,clearInterval(r.timer),o.msg("支付成功，正在为你跳转到首页。。。"),$.unlockBtn(t.find(".layui-layer-btn0"),"支付完成"),o.close(n),core.setWindowHash("manage_logs"),window.location.reload(!0)):5===a&&o.msg("订单未支付")}):clearInterval(r.timer)},1e4)}},error:function(){o.msg(baseDatas.netErrMsg)},complete:function(){$.removeLoading($(".js-pay-container"))}})}});return!1}function p(e){var t='<div class="layui-input-block">';$.each(e,function(e,a){e%4==0&&0!==e&&(t+='</div><div class="layui-input-block">'),t+=m(a,0===e)}),t+="</div>",$(".js-add-package-type-container").html(t),n.render("radio")}function m(e,a){return'<input type="radio" name="addPackageType"\n                    '+(a?"checked":"")+'\n                    value="'+e.id+'"\n                    data-purchase-score="'+e.packagePurchaseScore+'" \n                    data-present-score="'+e.packagePresentScore+'"\n                    data-purchase-money="'+e.packagePurchaseMoney+'" \n                    data-present-money="'+e.packagePresentMoney+'"\n                    title="'+e.packageName+'">\n                </input>'}function y(e,a,t){if(!e)return t(!1);$.ajax({url:"/api/getQrCodePayStatus",data:{qr_id:e,addPackageType:a,orderNumber:APIUtil.generateOrderNumer(),otherShareCode:s},success:function(e){t(e.data.status)}})}function a(e){return core.copyToClipBoard("jsShareEffect"),o.msg("推广文案已成功复制到粘贴吧，去推广吧"),!1}$("form[name=addMoneyForm] input[name=userName]").val($("#userName").text().trim()),core.getUserInfoById(function(e){var a;$("#userMainMoney").text(core.fenToYuan(e.data.rows[0].money)),s=e.data.rows[0].otherShareCode,u=e.data.rows[0].myShareCode,r.render((_defineProperty(a={elem:"#shareUserTable",url:"/api/readShareUserPage",page:!0,where:{myShareCode:u},cols:[[{field:"",title:"序号",width:60,templet:function(e){return e.LAY_INDEX}},{field:"userName",title:"用户名"},{field:"createdDate",title:"创建时间",templet:function(e){return c.toDateString(e.createdDate,"yyyy-MM-dd HH:mm")}}]],limits:[10,20,50,100]},"page",{theme:"#1E9FFF",layout:["prev","page","next","skip","count","limit"]}),_defineProperty(a,"request",{pageName:"offset"}),_defineProperty(a,"response",{statusCode:!0}),_defineProperty(a,"parseData",function(e){return{code:e.success,msg:e.msg,count:e.data.total,data:e.data.rows}}),a));var t=location.host+"/?otherShareCode="+e.data.rows[0].myShareCode;$("input[name=shareLink]").val(t),$("#jsShareEffect").val("亲爱的朋友，我正在使用易店科技优化店铺，效果很不错哦，你也可以试试。点击下方为你准备的专属链接"+t+"进行注册吧。注册就送2.5元。")}),$.ajax({url:"/api/readPackagePage",type:"GET",data:{limit:20,status:1,offset:1},beforeSend:function(e,a){$.addLoading()},success:function(e,a,t){e.success?(p(e.data.rows),n.on("radio",function(e){"addPackageType"===this.name&&l(e.elem)}),l($("input[type=radio][name=addPackageType]").first()[0])):(o.msg(e.message),p([]))},error:function(e,a,t){o.msg(baseDatas.netErrMsg)},complete:function(e,a){$.removeLoading()}}),n.render("checkbox"),$("#addMoney").on("click",e),$("#copyShareLink").on("click",a),$("#searchBtn").on("click",function(){var e;return e={userName:$("input[name=username]").val().trim(),page:{curr:1,limit:10}},r.reload("shareUserTable",{where:e}),!1}),$("#resetBtn").on("click",function(){return $("#shareUserSearchForm")[0].reset(),!1})});