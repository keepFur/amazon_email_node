"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}layui.use(["element","table","layer","util","form","laydate"],function(){var e,t=layui.element,n=layui.table,i=layui.layer,r=layui.util,a=layui.form,l=layui.laydate,c={netErrMsg:"系统已退出登录，请登录系统重试",operatorErrMsg:{single:"请选择一条数据操作",batch:"请至少选择一条数据操作"},plants:["TB","JD","PDD"],tabIndex:0};function d(e){var t=m();return t.createdDateStart=t.createdDate.split("~")[0],t.createdDateEnd=t.createdDate.split("~")[1],b($.extend(t,{plant:c.plants[c.tabIndex],page:{curr:1,limit:10}})),!1}function o(e){return $(".flyer-layout-tree .flyer-layout-link[data-hash=kb_purchase]").click(),!1}function u(){var e=document.createElement("a");return e.href="/api/exportKbOrderToExcel?limit=1000&offset=1",e.click(),!1}function s(e){var t=document.createElement("a"),r=m();return r.createdDateStart=r.createdDate.split("~")[0],r.createdDateEnd=r.createdDate.split("~")[1],t.href="/api/downloadKbOrderToExcel?limit=1000&offset=1&"+core.objectToString(r),t.click(),!1}function p(e){var t=document.createElement("a");return t.href="/api/pddBatch?limit=1000&offset=1&plant=PDD",t.click(),!1}function f(e){var r=n.checkStatus("kbOrderTable").data,a=e.data.type,t=2===a?"确定标记为已扫描状态吗？":"确定标记为取消状态吗？";return 0<r.length?i.confirm(t,{title:"询问框",btn:["确定","取消"]},function(e,t){$.ajax({url:"/api/toggleKbOrder",type:"POST",data:{id:r.map(function(e){return e.id}),status:a},success:function(e,t,r){i.msg(e.success?"操作成功！":"操作失败："+e.message),b()},error:function(e,t,r){i.msg(c.netErrMsg)}})}):i.msg(c.operatorErrMsg.batch),!1}function m(){var e=$("#kbOrderSearchForm").serializeArray(),r={};return $.each(e,function(e,t){r[t.name]=t.value}),r}function b(e){n.reload("kbOrderTable",{where:e})}function y(e){$.get("/api/readKbType?status=1&plant="+e,function(e){var t,r;t=e.data.rows,(r=$("select[name=kbCompany]")).empty(),r.append('<option value="">请选择快递类型</option>'),$.each(t,function(e,t){r.append('<option value="'+t.code+'" data-price="'+t.price+'" data-plant="'+t.plant+'">'+t.name+"</option>")}),a.render("select")},"json")}y("TB"),a.render("select"),l.render({elem:"#createdDate",range:"~"}),n.render((_defineProperty(e={elem:"#kbOrderTable",url:"/api/readKbOrderPage",page:!0,where:{plant:"TB"},cols:[[{checkbox:!0,fixed:"left"},{field:"",title:"序号",fixed:"left",templet:function(e){return e.LAY_INDEX}},{field:"number",title:"订单号",width:220},{field:"kbNumber",title:"快递单号",width:220},{field:"kbCompany",title:"快递公司/平台",width:150,templet:function(e){return core.getKbTypeByCode(e.kbCompany)+"/"+core.getPlantByCode(e.plant)}},{field:"addressFrom",title:"发件人信息",width:300},{field:"addressTo",title:"收件人信息",width:300},{field:"remark",title:"备注",width:150},{field:"createdDate",title:"创建时间",width:200,templet:function(e){return r.toDateString(e.createdDate,"yyyy-MM-dd HH:mm")}},{field:"status",title:"状态",width:120,fixed:"right",align:"center",templet:function(e){return'<span class="layui-text-'+(1==e.status?"green":"pink")+'">'+["","待扫描","已扫描","已取消"][e.status]+"</span>"}}]],limits:[10,20,50,100]},"page",{theme:"#1E9FFF",layout:["prev","page","next","skip","count","limit"]}),_defineProperty(e,"request",{pageName:"offset"}),_defineProperty(e,"response",{statusCode:!0}),_defineProperty(e,"parseData",function(e){return{code:e.success,msg:e.msg,count:e.data.total,data:e.data.rows}}),e)),t.on("tab(manageKbOrder)",function(e){e.index!==c.tabIndex&&(b({plant:c.plants[e.index]}),c.tabIndex=e.index,$("#pddBatchBtn").toggleClass("layui-hide",2!==e.index),y(e.value))}),$("#searchBtn").on("click",d),$("#resetBtn").on("click",function(){return $("#kbOrderSearchForm")[0].reset(),!1}),$("#createKbOrderBtn").on("click",o),$("#exportKbOrderBtn").on("click",u),$("#downloadKbOrderBtn").on("click",s),$("#pddBatchBtn").on("click",p),$("#cancelKbOrderBtn").on("click",{type:3},f),$("#markScanedKbOrderBtn").on("click",{type:2},f)});