"use strict";layui.use(["element","layer","form"],function(){layui.element;var r=layui.layer,a=(layui.form,"密码是由6-15位的数字或密码组成"),s="电话是由11位的数字组成",n=$("#userName").data("user-id"),o=$("#userName").data("user-name"),t=0,u=990;function e(e){var a={id:n,email:$("form[name=userUpdateForm] input[name=email]").val(),QQ:$("form[name=userUpdateForm] input[name=QQ]").val(),phone:$("form[name=userUpdateForm] input[name=phone]").val()};if(/^1[0-9]{10}$/.test(a.phone))return $.ajax({url:"/api/updateUser",type:"POST",data:a,success:function(e,a,s){r.msg(e.success?"操作成功":"操作失败"),d(l)},error:function(e,a,s){r.msg(baseDatas.errorMsg)}}),!1;r.msg(s)}function m(e){var n={old:$("form[name=userUpdatePasswordForm] input[name=oldPassword]").val(),new:$("form[name=userUpdatePasswordForm] input[name=password]").val()};return/^[a-zA-Z0-9]{6,15}$/g.test(n.old)&&/^[a-zA-Z0-9]{6,15}$/g.test(n.new)?n.new===n.old?r.msg("新密码和就密码一致，无需修改"):$.ajax({url:"/api/userLogin",method:"POST",data:{password:n.old,userName:o},dataType:"json",success:function(e,a,s){e.success?$.ajax({url:"/api/setUserPassword",type:"POST",dataType:"json",data:{userName:o,password:n.new},success:function(e,a,s){e.success?(r.msg("操作成功，请重新登录"),window.location.href="/api/logout"):r.msg("操作失败")}}):r.msg("原密码不正确")},error:function(e,a,s){mdui.snackbar({message:"网络错误",position:"top"})}}):r.msg(a),!1}function i(e){return 2===t?r.msg("老板，你已经是我们的顶级会员了，已经大权在握，杠杠的！！！"):d(function(e){var a=e.money;u<=a?$.ajax({url:"/api/updateLevelUser",type:"POST",data:{id:n,level:2,money:a,userName:o,orderNumber:APIUtil.generateOrderNumer()},success:function(e,a,s){r.msg(e.success?"恭喜老板，你已经成为最高等级的会员了，赶紧去下单享受特权吧！！！":"操作失败"+e.message),d(l)},error:function(e,a,s){r.msg(baseDatas.netErrMsg)}}):r.msg("您的账户余额不足"+core.fenToYuan(u)+"元， 请充值之后再升级。当前账户余额是 "+core.fenToYuan(a)+" 元!")}),!1}function d(a){$.get("/api/readUserById?id="+n,function(e){e.success?a(e.data.rows[0]):r.msg("服务器发生异常")},"json")}function l(e){$("form[name=userUpdateForm] input[name=email]").val(e.email),$("form[name=userUpdateForm] input[name=QQ]").val(e.QQ),$("form[name=userUpdateForm] input[name=phone]").val(e.phone),$("form[name=updateLevelForm] input[name=oldLevel]").val((2===e.level?"金牌会员（":"普通会员（")+core.fenToYuan(e.money)+"）元"),t=e.level}d(l),$("#updateInfoBtn").on("click",e),$("#updatePasswordBtn").on("click",m),$("#updateLevelBtn").on("click",i)});