"use strict";layui.use(["element","layer","form"],function(){layui.element;var r=layui.layer,s=(layui.form,$("#userName").data("user-id")),o=$("#userName").data("user-name");function a(a){var e={id:s,email:$("form[name=userUpdateForm] input[name=email]").val(),QQ:$("form[name=userUpdateForm] input[name=QQ]").val(),phone:$("form[name=userUpdateForm] input[name=phone]").val()};if(e.phone)return $.ajax({url:"/api/updateUser",type:"POST",data:e,success:function(a,e,s){r.msg(a.success?"操作成功":"操作失败"),n()},error:function(a,e,s){r.msg(baseDatas.errorMsg)}}),!1;r.msg("手机号不能为空")}function e(a){var n={old:$("form[name=userUpdatePasswordForm] input[name=oldPassword]").val(),new:$("form[name=userUpdatePasswordForm] input[name=password]").val()};return n.old&&n.new?n.new===n.old?r.msg("新密码和就密码一致，无需修改"):$.ajax({url:"/api/userLogin",method:"POST",data:{password:n.old,userName:o},dataType:"json",success:function(a,e,s){a.success?$.ajax({url:"/api/setUserPassword",type:"POST",dataType:"json",data:{userName:o,password:n.new},success:function(a,e,s){a.success?(r.msg("操作成功，请重新登录"),window.location.href="/api/logout"):r.msg("操作失败")}}):r.msg("原密码不正确")},error:function(a,e,s){mdui.snackbar({message:"网络错误",position:"top"})}}):r.msg("密码不能为空"),!1}function n(){$.get("/api/readUserById?id="+s,function(a){var e;a.success?(e=a.data.rows[0],$("form[name=userUpdateForm] input[name=email]").val(e.email),$("form[name=userUpdateForm] input[name=QQ]").val(e.QQ),$("form[name=userUpdateForm] input[name=phone]").val(e.phone)):r.msg("服务器发生异常")},"json")}n(),$("#updateInfoBtn").on("click",a),$("#updatePasswordBtn").on("click",e)});