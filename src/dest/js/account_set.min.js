"use strict";layui.use(["element","layer","form"],function(){layui.element;var r=layui.layer,n=(layui.form,$("#userName").data("user-id")),o=$("#userName").data("user-name"),a=0,s=990;function e(e){var a={id:n,email:$("form[name=userUpdateForm] input[name=email]").val(),QQ:$("form[name=userUpdateForm] input[name=QQ]").val(),phone:$("form[name=userUpdateForm] input[name=phone]").val()};if(a.phone)return $.ajax({url:"/api/updateUser",type:"POST",data:a,success:function(e,a,n){r.msg(e.success?"操作成功":"操作失败"),m(i)},error:function(e,a,n){r.msg(baseDatas.errorMsg)}}),!1;r.msg("手机号不能为空")}function u(e){var s={old:$("form[name=userUpdatePasswordForm] input[name=oldPassword]").val(),new:$("form[name=userUpdatePasswordForm] input[name=password]").val()};return s.old&&s.new?s.new===s.old?r.msg("新密码和就密码一致，无需修改"):$.ajax({url:"/api/userLogin",method:"POST",data:{password:s.old,userName:o},dataType:"json",success:function(e,a,n){e.success?$.ajax({url:"/api/setUserPassword",type:"POST",dataType:"json",data:{userName:o,password:s.new},success:function(e,a,n){e.success?(r.msg("操作成功，请重新登录"),window.location.href="/api/logout"):r.msg("操作失败")}}):r.msg("原密码不正确")},error:function(e,a,n){mdui.snackbar({message:"网络错误",position:"top"})}}):r.msg("密码不能为空"),!1}function t(e){return 2===a?r.msg("老板，你已经是我们的顶级会员了，已经大权在握，杠杠的！！！"):m(function(e){var a=e.money;s<=a?$.ajax({url:"/api/updateLevelUser",type:"POST",data:{id:n,level:2,orderNumber:APIUtil.generateOrderNumer()},success:function(e,a,n){r.msg(e.success?"恭喜老板，你已经成为最高等级的会员了，赶紧去下单享受特权吧！！！":"操作失败"+e.message),m(i)},error:function(e,a,n){r.msg(baseDatas.netErrMsg)}}):r.msg("您的账户余额不足"+core.fenToYuan(s)+"元， 请充值之后再升级。当前账户余额是 "+core.fenToYuan(a)+" 元!")}),!1}function m(a){$.get("/api/readUserById?id="+n,function(e){e.success?a(e.data.rows[0]):r.msg("服务器发生异常")},"json")}function i(e){$("form[name=userUpdateForm] input[name=email]").val(e.email),$("form[name=userUpdateForm] input[name=QQ]").val(e.QQ),$("form[name=userUpdateForm] input[name=phone]").val(e.phone),$("form[name=updateLevelForm] input[name=oldLevel]").val((2===e.level?"金牌会员（":"普通会员（")+core.fenToYuan(e.money)+"）元"),a=e.level}m(i),$("#updateInfoBtn").on("click",e),$("#updatePasswordBtn").on("click",u),$("#updateLevelBtn").on("click",t)});