"use strict";layui.use(["element","layer","form"],function(){layui.element;var t=layui.layer,a=(layui.form,"密码是由6-15位的数字或密码组成"),o="电话是由11位的数字组成",r=$("#userName").data("user-id"),s=$("#userName").data("user-name"),u=0,m=990;function e(e){var a={id:r,email:$("form[name=userUpdateForm] input[name=email]").val(),QQ:$("form[name=userUpdateForm] input[name=QQ]").val(),phone:$("form[name=userUpdateForm] input[name=phone]").val()},n=$(e.target);if(/^1[0-9]{10}$/.test(a.phone))return $.ajax({url:"/api/updateUser",type:"POST",data:a,beforeSend:function(){$.lockedBtn(n,!0,"修改中")},success:function(e,a,n){t.msg(e.success?"操作成功":"操作失败"),c(l)},error:function(e,a,n){t.msg(baseDatas.errorMsg)},complete:function(){$.unlockBtn(n,"修改")}}),!1;t.msg(o)}function n(e){var o={old:$("form[name=userUpdatePasswordForm] input[name=oldPassword]").val(),new:$("form[name=userUpdatePasswordForm] input[name=password]").val()},r=$(e.target);return/^[a-zA-Z0-9@]{6,15}$/g.test(o.old)&&/^[a-zA-Z0-9@]{6,15}$/g.test(o.new)?o.new===o.old?t.msg("新密码和旧密码一致，无需修改"):$.ajax({url:"/api/userLogin",method:"POST",data:{password:o.old,userName:s},dataType:"json",success:function(e,a,n){e.success?$.ajax({url:"/api/setUserPassword",type:"POST",dataType:"json",data:{userName:s,password:o.new},beforeSend:function(){$.lockedBtn(r,!0,"修改中")},success:function(e,a,n){e.success?(t.msg("操作成功，请重新登录"),window.location.href="/api/logout"):t.msg("操作失败")},complete:function(){$.unlockBtn(r,"修改")}}):t.msg("原密码不正确")},error:function(e,a,n){mdui.snackbar({message:"网络错误",position:"top"})}}):t.msg(a),!1}function i(e){if(2===u)return t.msg("老板，你已经是我们的顶级会员了，已经大权在握，杠杠的！！！"),!1;var n=$(e.target);return c(function(e){var a=e.money;m<=a?$.ajax({url:"/api/updateLevelUser",type:"POST",data:{id:r,level:2,money:a,userName:s,orderNumber:APIUtil.generateOrderNumer()},beforeSend:function(){$.lockedBtn(n,!0,"升级中")},success:function(e,a,n){t.msg(e.success?"恭喜老板，你已经成为最高等级的会员了，赶紧去下单享受特权吧！！！":"操作失败"+e.message),c(l)},error:function(e,a,n){t.msg(baseDatas.netErrMsg)},complete:function(){$.unlockBtn(n,"立马升级，享受特权")}}):t.msg("您的账户余额不足"+core.fenToYuan(m)+"元， 请充值之后再升级。当前账户余额是 "+core.fenToYuan(a)+" 元!")}),!1}function c(a){$.get("/api/readUserById?id="+r,function(e){e.success?a(e.data.rows[0]):t.msg("服务器发生异常")},"json")}function l(e){$("form[name=userUpdateForm] input[name=email]").val(e.email),$("form[name=userUpdateForm] input[name=QQ]").val(e.QQ),$("form[name=userUpdateForm] input[name=phone]").val(e.phone),$("form[name=updateLevelForm] input[name=oldLevel]").val((2===e.level?"金牌会员（":"普通会员（")+core.fenToYuan(e.money)+"）元"),u=e.level}c(l),$("#updateInfoBtn").on("click",e),$("#updatePasswordBtn").on("click",n),$("#updateLevelBtn").on("click",i)});